# Development Log - 2026-01-13

## Summary of Changes
Successfully migrated the project to GenUI version 0.6.1 and integrated dynamic surface rendering for the `InfoCard` and `StatusBadge` widgets.

## Problems Solved

### 1. Persistent `win32` / FFI Build Errors
- **Problem**: The app refused to build for iOS simulator due to `win32` dependency errors (`UnmodifiableUint8ListView` not found and `.address` FFI errors).
- **Solution**: Removed `file_picker` and `open_filex` packages. These were transitive dependencies forcing a legacy version of `win32` onto the build environment. Removing them allowed the environment to use compatible packages.
- **Wrong Path**: Spent significant time trying to force `win32` version overrides in `pubspec.yaml`, which failed because the conflicting packages strictly required the older version.

### 2. iOS Deployment Target Mismatches
- **Problem**: Multiple "deployment target" warnings and errors for various Pods (e.g., `image_picker`).
- **Solution**: Updated `ios/Podfile` with a post-install hook to force `IPHONEOS_DEPLOYMENT_TARGET = '13.0'` for all targets and the project itself.

### 3. GenUI 0.6.1 API Migration
- **Problem**: The codebase was written for an older version of the `genui` package, leading to many compilation errors.
- **Solution**: 
    - Updated `CatalogItem` to use `dataSchema` and `widgetBuilder`.
    - Switched `GenUiConversation` usage to use the built-in `conversation` history list.
    - Switched from `JsonSchema` to `Schema` from the `json_schema_builder` package.

### 4. Rendering Failures in Simulator
- **Problem**: Success messages were appearing but the widgets were invisible.
- **Solution**:
    - **Catalog Merging**: Discovered that `GenUiSurface` expects a catalog with a specific standard ID (`a2ui.org:standard_catalog_0_8_0`) to find layout widgets like `Column`. Merged our custom items into the `CoreCatalog` and set the ID explicitly.
    - **Mock Data Fix**: The `StatusBadge` widget was missing a required `label` field in the mock response.
    - **Message Sequencing**: Optimized the `MockContentGenerator` to send `SurfaceUpdate` (caching components) before `BeginRendering` (triggering layout).

## Current State
- The app launches directly into `GenUiTestPage`.
- Triggering a mock response successfully renders a combined UI containing text and dynamic widgets (`InfoCard` and `StatusBadge`) inside a `Column`.
- All critical build blockers are resolved.

## Actions Not Worth Repeating (Anti-patterns)

- **Fiddling with `dependency_overrides` for Transitive Conflicts**: If a build error points to a core library like `win32` being the wrong version, check `pub pub deps` first. Forcing a version override in `pubspec.yaml` when other packages hard-require a different version is a "whack-a-mole" game that never ends. The better path is removing the conflicting leaf dependency.
- **Manual `.pbxproj` edits for Deployment Targets**: Updating the Xcode project manually is tedious and gets overwritten. Always use the `Podfile` post-install script to ensure all Pods and Targets are aligned to the same iOS version.
- **Hoping `flutter clean` fixes Dependency Hell**: While `flutter clean` is great for caching issues, it doesn't fix logic conflicts in `pubspec.yaml`. Don't repeat "clean and run" more than twice without changing the dependency tree.
- **Assuming Catalog Resolution Logic**: Don't assume `GenUiSurface` will merge catalogs for you. If using layout components (Column, Row), they *must* be in the catalog passed to the processor, and the Catalog ID *must* match what the processor/surface expects (defaulting to the standard A2UI ID).
- **Incomplete Mock Sequences**: In GenUI, sending `BeginRendering` before `SurfaceUpdate` (with components) can lead to empty states or errors. Always cache the components first or send them in the same turn.
